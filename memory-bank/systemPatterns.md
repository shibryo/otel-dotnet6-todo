# システムパターン

## アーキテクチャ概要

```mermaid
graph TD
    A[Todo Frontend] -->|HTTP| B[Todo API]
    B -->|SQL| C[PostgreSQL]
    B -->|Export| D[OTel Collector]
    D -->|Export| E[Jaeger]
    D -->|Export| F[Grafana]
```

## アーキテクチャ設計方針

### 1. レイヤードアーキテクチャ

1. プレゼンテーション層

   - React フロントエンド
   - RESTful API エンドポイント

2. ビジネスロジック層

   - Todo アイテム管理
   - OpenTelemetry 計装

3. データアクセス層
   - Entity Framework Core
   - リポジトリパターン

### 2. クリーンアーキテクチャ

1. エンティティ層

   - Todo モデル
   - ビジネスルール

2. ユースケース層

   - Todo CRUD 操作
   - トレーシング統合

3. インターフェースアダプター層

   - コントローラー
   - データベースアクセス
   - 外部サービス連携

4. フレームワーク・ドライバー層
   - ASP.NET Core
   - PostgreSQL
   - OpenTelemetry SDK

## 技術的判断基準

### 1. アプリケーション設計

1. シンプルさの重視

   - 最小限の機能セット
   - 明確な責任分離
   - 理解しやすいコード構造

2. テスタビリティ

   - 依存性注入の活用
   - モックフレンドリーな設計
   - テスト容易性の確保

3. メンテナンス性
   - 一貫したコーディング規約
   - 適切なドキュメント
   - 疎結合な設計

### 2. 可観測性設計

1. トレーシング戦略

   - リクエスト全体の追跡
   - エラーコンテキストの収集
   - パフォーマンス測定ポイント

2. メトリクス設計

   - アプリケーションヘルス
   - ビジネスメトリクス
   - リソース使用率

3. ログ設計
   - 構造化ログ
   - コンテキスト情報
   - ログレベル管理

## システム連携パターン

### 1. フロントエンド・バックエンド連携

- RESTful API による通信
- HTTP/HTTPS プロトコル
- JSON データフォーマット

### 2. データベース連携

- Entity Framework Core
- コードファーストアプローチ
- マイグレーション管理

### 3. モニタリング連携

- OpenTelemetry Protocol (OTLP)
- Collector による集中管理
- 各バックエンドへのエクスポート

## エラーハンドリングパターン

1. アプリケーションエラー

   - グローバルエラーハンドリング
   - 構造化されたエラーレスポンス
   - エラーログ記録

2. インフラストラクチャエラー

   - リトライパターン
   - サーキットブレーカー
   - フォールバック戦略

3. 監視エラー
   - デッドレター処理
   - バッファリング
   - エラー通知

## デプロイメントパターン

### ローカル開発環境

1. Dev Container

   - 統合開発環境
   - 依存関係管理
   - ツール設定

2. Docker Compose
   - サービス定義
   - 環境変数管理
   - ボリューム設定
