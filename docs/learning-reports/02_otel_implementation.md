# OpenTelemetry学習レポート

## 1. 主要な学習内容

### 1.1 トレースの実装

- ActivitySourceを使用したトレースの作成
- 自動計装（ASP.NET Core、Entity Framework Core）の設定
- カスタムタグによる詳細情報の記録
- トレースコンテキストの伝播

### 1.2 メトリクスの収集

- Counter型メトリクスによるTodo作成数・完了数の計測
- メトリクスの集計と出力間隔の設定
- カスタムMeterの作成と使用方法
- メトリクス種別（Counter、UpDownCounter、Histogram）の使い分け

### 1.3 構造化ログの実装

- JSON形式でのログ出力設定
- イベントIDによるログの分類（1000番台：CRUD、2000番台：エラー等）
- ログスコープを使用したコンテキスト情報の付加
- トレース情報とログの連携

## 2. 実装で苦労した点

### 2.1 技術的な課題

- メトリクスの出力タイミングの制御

  - デフォルトの60秒間隔では動作確認が難しい
  - 適切な出力間隔の設定が必要

- ログイベントの設計

  - イベントIDの体系化
  - 適切なログレベルの選択

### 2.2 発生したエラーと解決策

- IMeterFactoryの解決エラー

  - 原因：必要なパッケージの不足
  - 解決：OpenTelemetry.Metricsパッケージの追加

- コンパイルエラー（中括弧の不一致）

  - 原因：PUTメソッドの実装ミス
  - 解決：コードフォーマットの修正

## 3. 次回の実践に向けたポイント

### 3.1 実装手順の最適化

1. トレース機能の実装

   - 自動計装の設定
   - 必要な箇所へのカスタム計装の追加

2. メトリクスの実装

   - メトリクス種別の選定
   - 出力設定の調整

3. ログ機能の実装

   - イベント定義
   - トレースとの連携設定

### 3.2 注意点とベストプラクティス

- メトリクスの命名規則の統一
- ログレベルの適切な使い分け
- トレース情報の過剰な収集を避ける
- エラーハンドリングの一貫性確保

### 3.3 追加検討項目

- カスタムメトリクスの種類の拡張
- より詳細なエラー情報の収集
- パフォーマンスへの影響の測定
- セキュリティ関連情報の適切な扱い
