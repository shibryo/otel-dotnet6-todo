# OpenTelemetry学習レポート - 柴田のフィードバック

## 1. 学んだポイント

### 1.1 トレース

- ActivitySourceによるトレースの仕組み

  - タグでの情報付加が便利
  - エラー情報も記録できる

- 自動計装の設定が簡単

  - ASP.NET CoreとEF Coreの連携が自動で行える
  - カスタム計装との組み合わせも容易

### 1.2 メトリクス

- カウンターの使い方

  - 単調増加のみ（作成数、完了数）
  - 増減する値はUpDownCounterを使用

- 出力の制御

  - デフォルト60秒は長い
  - テスト時は短く設定が便利

### 1.3 ログ

- 構造化ログの有用性

  - JSON形式で扱いやすい
  - トレース情報との連携が可能

- イベントIDの設計

  - 1000番台：CRUD操作
  - 2000番台：エラー
  - 番台で分類すると管理しやすい

## 2. 実装時に気をつけたこと

### 2.1 コードの構造

- 責任の分離

  - メトリクス用のクラスを分離
  - ログイベントの定義を集約

- エラーハンドリング

  - try-catchでのログ記録
  - エラー情報のタグ付け

### 2.2 設定のポイント

- 名前空間の整理

  - Metrics、Loggingで分離
  - 適切な依存関係の設定

- 出力形式の統一

  - タイムスタンプはUTC
  - インデントの設定

## 3. 今後の活用に向けて

### 3.1 応用したい部分

- メトリクスの種類を増やす

  - レスポンスタイムの分布
  - エラー率の測定

- トレース情報の活用

  - パフォーマンス分析
  - エラー追跡の効率化

### 3.2 改善したい点

- テストコードの追加
- メトリクス設計の見直し
- ログレベルの最適化

## 4. 次のステップ

- Grafanaでの可視化
- アラート設定の検討
- パフォーマンス影響の測定
